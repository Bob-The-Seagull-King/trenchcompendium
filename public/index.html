<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
        <meta name="theme-color" content="#2a2a2a" />

        <link rel="icon" href="%PUBLIC_URL%/favicon/favicon.ico" />
        <link rel="icon" type="image/png" href="%PUBLIC_URL%/favicon/favicon-32x32.png" sizes="32x32" />
        <link rel="icon" type="image/png" href="%PUBLIC_URL%/favicon/favicon-16x16.png" sizes="16x16" />
        <link rel="apple-touch-icon" href="%PUBLIC_URL%/favicon/apple-touch-icon.png" />

        <link rel="manifest" href="%PUBLIC_URL%/manifest.json" />

         <link href="/static/css/main.c02abf55.css" rel="stylesheet">
         <title>Trench Companion | The officially supported Trench Crusade ressource</title>
         <meta name="description" content="The official resource for Trench Crusade" data-react-helmet="true">
         <meta property="og:description" content="The official resource for Trench Crusade" data-react-helmet="true">
         <meta property="og:title" content="Trench Companion | Trench Companion" data-react-helmet="true">
         <meta property="og:type" content="website" data-react-helmet="true">

        <!-- Whatever this does -->
        <meta name="referrer" content="strict-origin-when-cross-origin">

        <!-- Helps with verification (optional) -->
        <meta name="google-adsense-account" content="ca-pub-3744837400491966" />

        <!-- Script from adsense for auto ads-->
        <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3744837400491966"
                crossorigin="anonymous"></script>
        <!-- https://support.google.com/adsense/answer/7584263 (Beispiel) -->
        <!-- https://support.google.com/adsense/answer/9274516 (Platzierung im <head>) -->

        <!-- 1) Data Layer + gtag-Wrapper + Consent-Defaults + TCF -->
        <script>
            // Data Layer anlegen, bevor GTM geladen wird
            window.dataLayer = window.dataLayer || [];
            function gtag(){ dataLayer.push(arguments); }

            // Consent-Defaults: alles "denied" bis zur Nutzerentscheidung
            gtag('consent', 'default', {
                ad_storage:         'denied',
                analytics_storage:  'denied',
                ad_user_data:       'denied',
                ad_personalization: 'denied',
                wait_for_update:    500
            });

            // IAB TCF Unterstützung aktivieren (empfohlen)
            // Quelle: "Implement the Transparency & Consent Framework"
            window['gtag_enable_tcf_support'] = true;
        </script>

        <!-- 2) Funding Choices / AdSense CMP -->
        <script async src="https://fundingchoicesmessages.google.com/i/pub-3744837400491966?ers=1"></script>
        <script>
            // signalGooglefcPresent (von Google bereitgestelltes Snippet)
            (function signalGooglefcPresent() {
                if (!window.frames['googlefcPresent']) {
                    if (document.body) {
                        var iframe = document.createElement('iframe');
                        iframe.style = 'width:0;height:0;border:none;z-index:-1000;left:-1000px;top:-1000px;display:none;';
                        iframe.name  = 'googlefcPresent';
                        document.body.appendChild(iframe);
                    } else {
                        setTimeout(signalGooglefcPresent, 0);
                    }
                }
            })();
        </script>

        <!-- 3) Consent verarbeiten und DANN GTM mit OFFIZIELLEM Snippet laden -->
        <script>
            (function() {
                var gtmLoaded = false;

                function loadGTM() {
                    if (gtmLoaded) return;
                    gtmLoaded = true;

                    // *** OFFIZIELLES GTM-SNIPPET (unverändert!) ***
                    (function(w,d,s,l,i){
                        w[l]=w[l]||[];
                        w[l].push({'gtm.start': new Date().getTime(), event:'gtm.js'});
                        var f=d.getElementsByTagName(s)[0],
                            j=d.createElement(s),
                            dl=l!='dataLayer'?'&l='+l:'';
                        j.async=true;
                        j.src='https://www.googletagmanager.com/gtm.js?id='+i+dl;
                        f.parentNode.insertBefore(j,f);
                    })(window,document,'script','dataLayer','GTM-NFVT7W7X');
                }

                // Funding Choices Callback-Queue
                window.googlefc = window.googlefc || {};
                googlefc.callbackQueue = googlefc.callbackQueue || [];

                // Wenn Consent-Mode-Daten bereit: Consent-Werte lesen -> gtag update -> GTM laden
                googlefc.callbackQueue.push({
                    CONSENT_MODE_DATA_READY: function () {
                        try {
                            var status = googlefc.getGoogleConsentModeValues();
                            var E = googlefc.ConsentModePurposeStatusEnum;
                            var map = function(v){ return v === E.CONSENT_MODE_PURPOSE_STATUS_GRANTED ? 'granted' : 'denied'; };

                            gtag('consent','update', {
                                ad_storage:         map(status.adStoragePurposeConsentStatus),
                                analytics_storage:  map(status.analyticsStoragePurposeConsentStatus),
                                ad_user_data:       map(status.adUserDataPurposeConsentStatus),
                                ad_personalization: map(status.adPersonalizationPurposeConsentStatus)
                            });
                        } catch(e) {
                            // Falls FC keine Mode-Werte liefert, bleiben Defaults aktiv (denied)
                        }
                        loadGTM();
                    }
                });

                // Fallback: Falls FC-Callback NICHT feuert (z. B. Consent Mode in FC nicht aktiviert),
                // laden wir GTM nach 1500ms trotzdem – mit Defaults ("denied"), was DSGVO-konform ist.
                setTimeout(loadGTM, 1500);
            })();
        </script>

        <script>
            console.log('1.7');
        </script>

    </head>

    <body class="trench-companion">
        <!-- GTM Fallback -->
        <noscript>
            <iframe src="https://www.googletagmanager.com/ns.html?id=GTM-NFVT7W7X"
                    height="0" width="0" style="display:none;visibility:hidden"></iframe>
        </noscript>

        </noscript>
         <noscript>You need to enable JavaScript to run this app.</noscript>


         <div id="root"></div>
    </body>
</html>

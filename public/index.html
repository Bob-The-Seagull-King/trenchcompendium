<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
        <meta name="theme-color" content="#2a2a2a" />

        <link rel="icon" href="%PUBLIC_URL%/favicon/favicon.ico" />
        <link rel="icon" type="image/png" href="%PUBLIC_URL%/favicon/favicon-32x32.png" sizes="32x32" />
        <link rel="icon" type="image/png" href="%PUBLIC_URL%/favicon/favicon-16x16.png" sizes="16x16" />
        <link rel="apple-touch-icon" href="%PUBLIC_URL%/favicon/apple-touch-icon.png" />

        <link rel="manifest" href="%PUBLIC_URL%/manifest.json" />

         <link href="/static/css/main.c02abf55.css" rel="stylesheet">
         <title>Trench Companion | The officially supported Trench Crusade ressource</title>
         <meta name="description" content="The official resource for Trench Crusade" data-react-helmet="true">
         <meta property="og:description" content="The official resource for Trench Crusade" data-react-helmet="true">
         <meta property="og:title" content="Trench Companion | Trench Companion" data-react-helmet="true">
         <meta property="og:type" content="website" data-react-helmet="true">

        <!-- GTM Init -->
        <!-- Consent defaults: denied/NPA until user accepts -->
        <script>
            // Basic gtag setup
            window.dataLayer = window.dataLayer || [];
            window.gtag = function(){ dataLayer.push(arguments); };

            // Consent Mode defaults (GDPR-safe before any consent)
            gtag('consent','default',{
                ad_storage:'denied',
                analytics_storage:'denied',
                ad_user_data:'denied',
                ad_personalization:'denied'
            });
            gtag('set','ads_data_redaction', true);

            // Default to Non-Personalized Ads until user opts in
            window.adsbygoogle = window.adsbygoogle || [];
            window.adsbygoogle.requestNonPersonalizedAds = 1;
        </script>

        <!-- Load AdSense library ONCE in <head> so Google can detect it -->
        <script
                id="adsbygoogle-js"
                async
                src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3744837400491966"
                crossorigin="anonymous"></script>

        <!-- Mark library readiness and notify the app (used by AdsManagerv2) -->
        <script>
            (function () {
                // Prevent double-bootstrap on hot reloads
                if (window.__adsenseBootstrapped) return;
                window.__adsenseBootstrapped = true;

                var tag = document.getElementById('adsbygoogle-js');
                if (!tag) {
                    console.warn('[Ads] adsbygoogle.js tag not found');
                    return;
                }

                // Helper to set state and broadcast a single, consistent event
                function setLoaded(ok) {
                    window.adsenseScriptLoaded = !!ok;
                    window.dispatchEvent(new Event(ok ? 'adsense:loaded' : 'adsense:error'));
                }

                // Normal path: rely on the script load/error events
                tag.addEventListener('load',  function () { setLoaded(true);  });
                tag.addEventListener('error', function () { setLoaded(false); });

                // Safety fallback: in rare cases the load event may be missed (aggressive cache, preload, etc.).
                // If 2s after DOMContentLoaded the global queue exists, assume loaded and emit the event once.
                document.addEventListener('DOMContentLoaded', function () {
                    setTimeout(function () {
                        if (typeof window.adsenseScriptLoaded === 'undefined' &&
                            typeof window.adsbygoogle === 'object') {
                            setLoaded(true);
                        }
                    }, 2000);
                });
            })();
        </script>



        <!-- Klaro styles -->
        <link rel="stylesheet" href="%PUBLIC_URL%/klaro.css">
        <!-- Klaro config -->
        <script src="%PUBLIC_URL%/klaro-config.js"></script>
        <script defer src="%PUBLIC_URL%/klaro-no-css.js"></script>
        <script defer>
            window.addEventListener('DOMContentLoaded', function () {
                klaro.setup(klaroConfig);
            });
        </script>


    </head>

    <body class="trench-companion">
        <!-- Noscript Fallback for GTM -->
        <noscript>
            <iframe src="https://www.googletagmanager.com/ns.html?id=GTM-NFVT7W7X"
                    height="0" width="0"
                    style="display:none;visibility:hidden"></iframe>
        </noscript>
         <noscript>You need to enable JavaScript to run this app.</noscript>
         <style>#global-loader{position:fixed;inset:0;display:flex;align-items:center;justify-content:center;background:#2a2a2a;z-index:9999}.spinner{width:48px;height:48px;border:4px solid rgba(135,18,20,.5);border-top:4px solid #d01317;border-radius:50%;animation:spin 1s linear infinite}@keyframes spin{to{transform:rotate(360deg)}}</style>
         <style>
            #global-loader {
                position: fixed;
                inset: 0;
                display: flex;
                align-items: center;
                justify-content: center;
                background: #2a2a2a;
                z-index: 9999;
            }

            .spinner {
                width: 48px;
                height: 48px;
                border: 4px solid rgba(135,18,20,0.5);
                border-top: 4px solid #d01317;
                border-radius: 50%;
                animation: spin 1s linear infinite;
            }

            @keyframes spin {
                to {
                    transform: rotate(360deg);
                }
            }
         </style>
         <div id="global-loader">
            <div class="spinner"></div>
         </div>

         <div id="root"></div>
    </body>
</html>
